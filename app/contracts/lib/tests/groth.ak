//// Copyright (C) 2025 Logical Mechanism LLC
//// SPDX-License-Identifier: GPL-3.0-only
////

use aiken/builtin.{
  bls12_381_final_verify, bls12_381_g1_add, bls12_381_g1_compress,
  bls12_381_g1_neg, bls12_381_g1_uncompress,
  bls12_381_g2_compress, bls12_381_g2_uncompress, bls12_381_miller_loop,
  bls12_381_mul_miller_loop_result,
}
use types/groth.{CommitmentKey, GrothProof, SnarkVerificationKey}

test valid_groth_proof1() {
  // VK and proof from gnark output (out/vk.json, out/proof.json, out/public.json)
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 37,
      vkAlpha: #"abee8b9ac29a8c210210305b37260d1f6feab3a280ac5c4b405e5059c8575cf4b64a3c0137c3af086fb54adc3d0e88a7",
      vkBeta: #"81d0685ade0fb4e315d0903531d326c04bbd119cb85225446b4df7c05d986adb01ab87a50ddcd2bc45721a213210e5ae01f1e3b174a4fb7697aea8a0ff76689b310c53323cd833e2ce78eda70851015a3f19804e962613fce70a0106369fbc71",
      vkGamma: #"82471a11a3fe0376d7d418da6698d0a38cf48625ae8568e2114cd059717cfa139b72f3c56d2112444096580007e4f18c16ff4107abddef629a6bf442c3569d0b6af714a220c2443199cd66d41dd562f06d11182bbb15ac51008f320fab2841fe",
      vkDelta: #"94b47a4e90988d11e4518d156becc18899e92e326cfdfacd7e1d642612da093623a477efca132cc34f5b02cd55baabfd00999e419976f939c6e8bb531b08a46184fd85015729313470242564fd4ab9d83d53d70715b57faf9d2e74c5b2cb0e6f",
      vkIC: [
        #"960c021e695ef894b57ac3b3e965de7050facb0ccfb02842a481c3d186d53976af7ee27f46f315d427c388b0d5df7cdd",
        #"a19900f5b3770f49901824edc74cd7f05fa10ef6fb7e1a56d0e8e82afbaca7ca03d43d1aaed54cf73ad6dacda66fb9cb",
        #"a3fdf2bf06edd8a6c308d9c680e56cc12c76f5ac207000f0e0ea50d2a5f04cfdb386b3b81b1aacd3ffb07770c760ef52",
        #"b121796f0d692bd1cbcd8779fc5bb5637a0ec84f9efcb0fbe24d26205cd5c1e78374982186ecaef204805e2669723497",
        #"8494e95b76ebef2b508bffec157f604e0b8f45afa41d0223511c77b0246468424db3a70471493ca795972f498b3fa02e",
        #"93f663d0c0d492f03bb5e0882179252acb0443a6604dace9eacef876d51c7578ee7486b0369e6c35ec52c9381ea6acff",
        #"98e817ec48aa8b11c72b85bcf3beac384dacdeb9cd43089f9cc8ff3eb5aefd8a8f3b18cc1ee7e8a1cdab365fc5fc7465",
        #"8a71bc7f972ff091a96e5940b610845e9e590add777d1967969edfd630fb5b727755e1f1c98e15b661dd7b5571102a65",
        #"b0a7eeecdb147f0c99f32f00d2a331b9fcf2086916e179c13347db9bb43c962838ac06529893efcebc3db62b3d0122c1",
        #"a1394ad02bc64c88d4cbc31825ea34b7c67b08b74e64528feb8862d8e28417507c0a659f43664e234e6b99252faa382f",
        #"9586bf376cded257545842b236efae3d6379454bf8678009636efbd7e82282024b9fe9c22b67240f8d7000464356191d",
        #"864a7aa3d3942d4d4ef6c3cf6651e3b89a0c80d847b03b8d9aa1d150ed25d5183c97b5a472c33d9d65a07658fe15444c",
        #"ab7ba6def583d4bc86f21fc68920afb86165ff8e6e707c36357b8020ebe819f3eb0378e7e34d6d50516b5d19f62cc77a",
        #"a4dfa03b064f6565b05a51fa54a07d6a5fbfea331a0ccc04909f78d186b8e684e3b371338c4e005d0ad5f9d12aa88f61",
        #"ab6c4532943af63d9f3c96add10c3269002db50689b14bf4eadd13b35383af53513400c63ae9e83acd7cc083232794cf",
        #"b1426817418425801a25c424bf5399313b7919ef019ae9c9eb9d3d8358fe318a803af80983b191f0b28ba288461a805c",
        #"8fa08bc302b733a603135f13a87ea368a92e1d1b2b723af37d1e947395b23e5e4c91ba2190e3383437bed348df7684ad",
        #"a6a0e413681c4980c39d882df0dce73fe1b8600d7239804111b8112aef3807b68da0c3186efe743ef720b4a647acdd6d",
        #"8d5bcd982335f146402ade7d9cf89ee6ebd5c28f5ecef04f324c901316315e470f4abe46732521c0456f96a20198cc64",
        #"85a36cc938eee988a492da835b9c5b22196531fe6b60dba45ba7735c6fdee16aa6b9d0f11f53cf90b60a7639e2a06d06",
        #"8fc63f95cb58d977a1f048ca5e98549ee75ff9eb3248dc233c5cef11a2e9aecad8c73d23668944483e46047497e8fc01",
        #"aed031033af87dc6c6f6a7c5cc84a020e80d00609cdcf507cb28fb44f43900f8eda445361eb80b024d350c049fcc73e2",
        #"934cf97ee2e0ae7432877eb835aa190d16fceb5a1a613917758fcce2176e74f95217d27b470f652605400bb180b61c7b",
        #"ae5cb1661fec22d653eef8555ed157f41a6379829bf66fd72904ec57c2c5bbaf990d49c3bbff5f3b48642cfb40d27139",
        #"9042c63f7c9da430a8a645215bea475e69eb2e6edd0402b183e80a5bd0db895df649fbf4210136f794a6844f5062fa5e",
        #"ade1adb3867902a71f298dfe3e41962860617de87eaf56295c1915895f275b514d3e265b69b28d9a18074be0380bd3d7",
        #"aa532a52fa875d6abfe9f654d1d1b3b5525160c5bc6fcba3e7fb138deab71e49b6a7f6dd9cedff2612c0e7593c397da2",
        #"92ef20b372a8c097414d63f02816df8deaab0bd7d01764e28ff5bb96f32f567b2b1c6cae99453236f5284eb7bb6b3194",
        #"8b625074fc0972640e882e22cc028c8b267106f60b3aabaa5927be85787761b5869dc996188c1a3d91e90b72685dcec9",
        #"b34253e73c7880ad426ef5ae456feb8c25d546cf3d6bf69746e5b81b6ea1de8b126cfe77a6f2777154a182014ce5ed5e",
        #"b498d45c81e6363f7c9e4e2836fbd52eb96d4884fd88dbcc0665944d12493deedaaf4a18ab5e41b4a85c8b53768cf99e",
        #"a8230a7c9ccf370c2199fc2958682ac5fab2c4c059bbe0e4177bca196654d103a776a9ee932659d1ff737de4a6de6e77",
        #"8ab0b3a39ee93d203e8bb4b15a772174bd7d7db0e90f77f96b6aded042194d25245ca9f48586934bf0e87656ceafc2a2",
        #"b580dfb0134b03add7e2dfd2dc9c577a4ec4f180bec098b8c649c70c062a2ca52ee236401ea7a136eb7dd85cc2142174",
        #"b4e004d5c30039974ef309727aa7d8220a7a9cf68776ea78e0b1468048ec292122b65a519fdd08c4957b3d3b92e1443b",
        #"b39ad8c16efe0c9c8d696f7ffc18552cbd715edab02b8daea65b04ea1da3b8d768ce39f651f17dad97a47eb86c76130e",
        #"a67508287a5d797788014de16466a369c1e65a5d7a7566112a907b22281aac3e415b7cb27368678fc508e3bee822d044",
        #"adcc0878ee64a10b26bd1729c645c79ede68b2282ac5e9220ddf13acfa1442c265fe4fc0c3afd35c5254a88097acfd8e",
      ],
      commitmentKeys: [
        CommitmentKey {
          g: #"816a62146ee46d57c1969db77d7ab0056440dee8851d21bcc8036bd21b8c8d79171c24497c622fbcfc2421865d109f2302d29e3751e6d27ba2fbc792d699072135cbee6627d442185e12c8669584572d49890a14f69f1db286db17c3391f06c7",
          gSigmaNeg: #"86ef4a255377b2deeccc465e00d62660bfa6f7324f5928f7d0889479985ee8164217cbbbc7f71cb8bf372022f2432b3c14482c3deb86212c59710d4ebbeebba0d49727e875994b7346b36d7dc61c2026b94e4b25c53208f9a58a3c7b4b1d8ebd",
        },
      ],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"99d5bcfeb866aca22f1e3b222ac626106e10de89f4fd4ecc4eae742f346dd6106b87bd04de90398de7d6b683e80693e7",
      piB: #"84b1a59d6858416e68b489af5eace9bcbd26d41a1aec69fdba3021d8752d5303f922be7e1ded54a432f8428584e9d954124a4f18afd472e9404ec824e2bfd1b7440dd2077bd0240491e527b4d7a9e25304ecfd8a8d10dbcb8c1cfe3400bc25a4",
      piC: #"8d7f86284feda80e734fbc258d9239859bb34f833a66ab5d23ed72a97ce748a04ecd6a4f12f41dd15c8faa723ffde3cc",
      commitments: [
        #"847e670acbc6937cd7f93c90de99d3db2532ae25aa016721b041af51f03d39aeee7446a042b612467420937b188fe230",
      ],
      commitmentPok: #"b4aac57fabe8f02fb596a1b03108f822b3bfd60799b32f459af582dfffbdffecaae176e4482e52328c56f9b57ce27abd",
    }

  // Public inputs: 36 values (NOT including the implicit leading "1")
  // gnark's nPublic=37 includes witness[0]=1, but we only pass witness[1..36]
  let public_values: List<Int> =
    [
      17500288565172873801, 9411633287470898589, 11539752139897092681,
      14117566851138557178, 11732854847018214359, 149328769413022752,
      12743184510663640417, 3586972869393599483, 1162853564816257447,
      13963573845061158233, 8519358064772266323, 300849905542043934,
      7122734010029193537, 14091438530330602714, 18437455730936055131,
      1270115798220374375, 3523544288121143632, 1409434267968882308,
      7685756809009194907, 3596529320966201100, 6136440426073328453,
      7222376003872321934, 9282423828667808000, 1484539344460549012,
      7138643491626859436, 5505419637978662744, 7017732200911399991,
      6377522435931897794, 18011877622578215533, 776479359663048414,
      10288726997180865397, 18352781759426245713, 17860951621094200122,
      3645999937606863567, 7588265706522355601, 337242724379907695,
    ]

  // Commitment wire: computed by gnark as hash_to_field(D.Marshal() || committed_publics.Marshal())
  // D.Marshal() = D.RawBytes() = uncompressed G1 (96 bytes)
  let commitment_wires: List<Int> =
    [
      49991262587312637956023442585994913640804096857137196427912272488498041054114,
    ]

  groth.verify_groth16(vk, proof, public_values, commitment_wires)
}

test valid_groth_proof2() {
  // VK and proof from gnark output (out/vk.json, out/proof.json, out/public.json)
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 37,
      vkAlpha: #"b509ade27b2378801661877950ba25cb96d0efc874e99f912d5ef9e3d5890207d3f97870755da6159bc990f096135eb5",
      vkBeta: #"b47534fe779bf7daf3691ee513d9ca16e45c9a210032a86202040b8e749a907456c755d052debd1cb32a6896ea37e8e81537cb9cec6847e4d0fb194cf7dc25926e5e3a14961b8411d467132b1693f9f03a15b134260d4f8ebce57e42a4da095f",
      vkGamma: #"97562c6824438fe563498d0c28a0e14a6b8d6f0f2cbbb41245159225b9af05d0378a0ba9962df2daf55914787ecedbe30b79b0b6eb4d55707dae5a0fdf60fc6e4454c5e2e1512621c1b7cc25f2f9226ac84f7ccc3ead1a89335e73126104b615",
      vkDelta: #"af518f4d22ab8e79e5c9d0cf0d57d1c20278dc57d5538413a14cc44b75c4ffa59c646a406638c15fcfd9c61fb786571314aa8afbca24112e97c2ef6fc19395c038430ed8c86471317459498ab9c154289d9c6f3638a8f486d9592e21aa552898",
      vkIC: [
        #"8d0ac4bf3742f322ff87330ca9a20adf4fbaa4b051da865d13bbd3cb873b12665de4b62fd25246916beb1a9b5cb53e2d",
        #"a00b49b1cd11a9e0f0c5892d56de13ea95a7a274e90b90246c2d2f15f4971f1a907455b565c907563e5421326ea275f8",
        #"aac63a151b40f81228b4e2e88563a9e551255249efc8dfe6e84a6da3f100d88446382f56a7c586a7a1fbcd2f0faf51d8",
        #"85b16dea6167f6afe3c1097d77d2f81963af0babb9d88169ad86c3d4a88a17ce1ee0dbfd934a4741c81ed6646d4ea0dc",
        #"899091320ebf909a5c19e97876abf7a2f162a060271b966e8ecd52dfa6312f0caa7ea5b9f18ff167b6594081a13cf1c9",
        #"92d15311593fad747f476ecaf9bcabdabd1e6e494b0857c4ffba9e6c58b80772a94a9ebbd22666e8dee76788ea52b2ee",
        #"b074196a6800386c5adb94865210207cebdb5e9b2306e423e2c94af4f7f2256979a3e2aea7b8fb09d169e2b0b7085911",
        #"8571b904a2f0a049b6b8e92a36d8e8c34f508e887ad136facbff2fb86759a5858be3e7d2bd6853e3a605412a4bffb641",
        #"86b2659feddc91964aac9bf3aef2848140bd6a1e4851d0d98af4dc477357a222892fe8a72168368acb5a758c8045baf0",
        #"8684b8f381a00ed88ad767048d3a44975fed6e2df3000ce52f081c9ff06de0d47c4140727f0a0aa7c9a2ea316387aff7",
        #"b60be073020c42c2eb2a0b6e799e20e3c04b70e0ac78424d717c79beebcdd4d123a2199cd44679186f990ebcd3677aef",
        #"a6ef01888651898aa4c697ae7c615d80e6dcaa6e9d7e8931e76c98c44aaf4a3297bed6e814caa908ef5f8351d8b1cacd",
        #"ad40e84cad2a9b1f25e677ebba62cdae389d2fbbabf449853a985903917e08f8402a5555c3622f2ae5c0aacfeb87e041",
        #"b6a8f111f20fc19e0b263b2717e87ae7987608bd7da9ed499a7187feeecb442a986d172d95b5898a13902ec174d174bb",
        #"b200cd7e692f8accea6420833ef4853a76590f0920eb540026eb90b059010d96275ea4eef1edd8dbb70722ca8f7f2fa1",
        #"85d36561043785eb19cf8a89af9490bbfa0f638ffd2b915c3ac79b7aa2930660654c441d1fd6b0f2faf8b286bbe1c199",
        #"b805fa647722cfcb0f12be6d7717062a688962c6cb44784b7f1b795ee0fd9f18bc51002765a6e43d80e3065e0b0d92eb",
        #"b5f05efeff86f4a62db3c2a81d0e6b83f035747580dc10ca8938f71a9194c1cc4827d18d242af1d4d19be3ff6e92b31d",
        #"a34f7bf6bc53887904d4ae11db3e0fc291c28fcbd6ab50f3882f76ad9288716fe52fe665fa1de133fb7c527828372308",
        #"b4e3f4b6492a77ca8b1802a7f9df7cba5f3cc890b07e3b9d07defc6d1d66c9d9114415e80ba6d3ef6c13b4986e847f44",
        #"b4e6e23c5b964b15a040015738514f846c134f535a6e00a375db9d1b43622c7f6c4e24d87b2d8ad8c004bf5d087c44e3",
        #"a22243e393313d4ba55301937c0b492f9ae4419d6bf93c4ee390f4524e43facdb5d2e5b12e922c0fd22cd483bf02b90d",
        #"a1fc7603623063b3345e4a3e7699dd1e4b1985a810d7cf7f5f338264dc893125bf8b325b3e344fb3bc9e2a69e6870da2",
        #"8f83a820c5deff881eb6fa4f9b74bf5243e46bd2e5ca55af3655bcaa3d2fbeaed1bea087abeef917e7b57456fd03c6e8",
        #"aea448d6ff6a34b0ba0aa7cea9db2d1a4718d901e100222c220e5f527cc0a7f4e2c16ecf19e3578f40ffae9a6c5bbc7e",
        #"99e3d1c0815ea15d13e5774f6734347b437c1a8dfb00fca2654ea7ec7d2c0a5325a34a578cfc2b20608917feff87fd73",
        #"a4256a41a76a3422de321b7e398281ea97fcf77040b225084e44c62b1098d881d011a68b781a1c1def15c32939dddb44",
        #"820f181fbb75731f9a2970d1a3f44c62e57085bfd9d4498925aa9e54cabe07398fb17a8137c325c0838c05c96ed6a639",
        #"952631b20eebb6f99da053b952672477ad55ad0079fd86a1399ab78034f7d24580d2fee59f504835840912dcc2e6d8dd",
        #"820f3e4537a10e354bd4adc929b52128326e626bcf8ae630c5fbffe9a305ec6d1fb681b573995944f2778127b9119e53",
        #"ac9faed713abd9981670a032d76efa13130bcd8aee70e86c3aaef6d89f51437a3ddbc6ac7446638f0b061506d9a432ee",
        #"8de2a42760310cc61ab660d709f3e2cb84b970a64599b70ba47c8aa73a144f9022cb4beb9022b4d7f55ee5a7060f72bd",
        #"a3cdfc683ba5d6918b1f256a9aba28cadf7acf71f52077af377d2cba1ff82267a997e33136e4e50d6a9fa8874576a61a",
        #"8d31ee5889eeb4ecf9fa0a16eb43ba4940a1ca541eedcb07fef4d5a45a5bf78fe9c67607ead42a17a58852e55e5c90ec",
        #"944aa0a0a27c27adc2a9540c42e928263ab6149e381656de66e200c936fe0a2832b3f6a0a6b3191184c48cfb898fcb3b",
        #"ae8c39708377632e7711acb4b0edf0ad7fa71c0b41a56623672112df5c48ebd7e8893f42cc65c2b92de576d06e18dfe1",
        #"ac745c9128e775743036c8c15ebf31b4ce7847838237123bda592e988c11e5237c50fffb73ad8fbad78892a653abb46b",
        #"81e31a4c9cdf455ab3ca11d89652a62e3f81c4ca158bd2bf2c5dc30d89a4ca9113dbb3c030caa662a31a9e3f4a0faef0",
      ],
      commitmentKeys: [
        CommitmentKey {
          g: #"8b021b14ca2a446dbfcee3854b7d11582d5be9a4cf08c700aed0c3b697912cba51b6394184f0fe14edd132dbad0bccc816f80fafdb9389f858c0bf233f9ad11e1f1c4054e5fdce51d8087a8f4e76a8c0c12c1c18132f7eb919dc295ca4372cfb",
          gSigmaNeg: #"a33d5a37fe9894343ccb2142ac474aa564c20d3ac7638b58f95c44ffa44f7f52053d9dc52c3bd939a568457f28ea8d82064644c1207c2943969fac22bfa12eef6d157dff7dad385c2a12615b98961a671197a6d07747048e78540d84c2199bb2",
        },
      ],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"b878286b554c994c672eac483733f1e5794a5de88dddd504502c796eb696ac4a93f9a2c3e77ccbf9d48c4092aad3d89e",
      piB: #"824f89db10bf130cf41d746d9f891f01ff22992a6dd2e4a174b3add9b9b245249b15507f5fab688c13cbda1dd323fcd80b304b2e897bf41f643b773505fb4354c4251593f20bc4bbb8e8c4acd44f9f611295f77bd8a180d0d5b8287818acfdd7",
      piC: #"b3e5604d92619a4de04bbb03a2648df4d2c497f85962f9b8e2ef19ef4fec4ad2a611d57397519559a0a93a6c94e7f985",
      commitments: [
        #"ae619bf35f03603a589dc49e7c71b1c25db46196e8dbd854877f89ff02f59078ba58c888762ec68a5bc27b89b07ca58d",
      ],
      commitmentPok: #"b612b81a3810a494c939725c8dd6180c4abd702b16d183e5e8365a7d28a6a249ec1ab95625887567482c85307b939602",
    }

  // Public inputs: 36 values (NOT including the implicit leading "1")
  // gnark's nPublic=37 includes witness[0]=1, but we only pass witness[1..36]
  let public_values: List<Int> =
    [
      17500288565172873801, 9411633287470898589, 11539752139897092681,
      14117566851138557178, 11732854847018214359, 149328769413022752,
      12743184510663640417, 3586972869393599483, 1162853564816257447,
      13963573845061158233, 8519358064772266323, 300849905542043934,
      7122734010029193537, 14091438530330602714, 18437455730936055131,
      1270115798220374375, 3523544288121143632, 1409434267968882308,
      7685756809009194907, 3596529320966201100, 6136440426073328453,
      7222376003872321934, 9282423828667808000, 1484539344460549012,
      7138643491626859436, 5505419637978662744, 7017732200911399991,
      6377522435931897794, 18011877622578215533, 776479359663048414,
      10288726997180865397, 18352781759426245713, 17860951621094200122,
      3645999937606863567, 7588265706522355601, 337242724379907695,
    ]

  // Commitment wire: computed by gnark as hash_to_field(D.Marshal() || committed_publics.Marshal())
  // D.Marshal() = D.RawBytes() = uncompressed G1 (96 bytes)
  let commitment_wires: List<Int> =
    [
      25318525522981341336148859294455199719015856475893773867204323554663469803364,
    ]

  groth.verify_groth16(vk, proof, public_values, commitment_wires) && groth.verify_commitments(
    vk,
    proof,
  )
}

test g1_roundtrip_new_alpha() {
  let alpha =
    #"abee8b9ac29a8c210210305b37260d1f6feab3a280ac5c4b405e5059c8575cf4b64a3c0137c3af086fb54adc3d0e88a7"
  bls12_381_g1_compress(bls12_381_g1_uncompress(alpha)) == alpha
}

test g2_roundtrip_new_beta() {
  let beta =
    #"81d0685ade0fb4e315d0903531d326c04bbd119cb85225446b4df7c05d986adb01ab87a50ddcd2bc45721a213210e5ae01f1e3b174a4fb7697aea8a0ff76689b310c53323cd833e2ce78eda70851015a3f19804e962613fce70a0106369fbc71"
  bls12_381_g2_compress(bls12_381_g2_uncompress(beta)) == beta
}

test g1_roundtrip_new_piA() {
  let piA =
    #"99d5bcfeb866aca22f1e3b222ac626106e10de89f4fd4ecc4eae742f346dd6106b87bd04de90398de7d6b683e80693e7"
  bls12_381_g1_compress(bls12_381_g1_uncompress(piA)) == piA
}

test g2_roundtrip_new_piB() {
  let piB =
    #"84b1a59d6858416e68b489af5eace9bcbd26d41a1aec69fdba3021d8752d5303f922be7e1ded54a432f8428584e9d954124a4f18afd472e9404ec824e2bfd1b7440dd2077bd0240491e527b4d7a9e25304ecfd8a8d10dbcb8c1cfe3400bc25a4"
  bls12_381_g2_compress(bls12_381_g2_uncompress(piB)) == piB
}

test g1_roundtrip_new_commitment() {
  let commitment =
    #"847e670acbc6937cd7f93c90de99d3db2532ae25aa016721b041af51f03d39aeee7446a042b612467420937b188fe230"
  bls12_381_g1_compress(bls12_381_g1_uncompress(commitment)) == commitment
}

test final_verify_semantics_smoke() fail {
  let alpha_g1 =
    bls12_381_g1_uncompress(
      #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
    )
  let beta_g2 =
    bls12_381_g2_uncompress(
      #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
    )

  let x = bls12_381_miller_loop(alpha_g1, beta_g2)
  let x_inv = bls12_381_miller_loop(bls12_381_g1_neg(alpha_g1), beta_g2)

  // If final_verify checks "finalExp(x * y) == 1", then this should be True but it returns False
  bls12_381_final_verify(x, x_inv)
}

test final_verify_reflexive() {
  let a =
    bls12_381_g1_uncompress(
      #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
    )
  let b =
    bls12_381_g2_uncompress(
      #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
    )

  let ml = bls12_381_miller_loop(a, b)

  // MUST be True if final_verify behaves correctly for MlResult equality
  bls12_381_final_verify(ml, ml)
}

test ml_mul_matches_g1_add() {
  // use the same canonical generators you used above
  let p =
    bls12_381_g1_uncompress(
      #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
    )
  let q =
    bls12_381_g2_uncompress(
      #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
    )

  // x = e(p, q)
  let x = bls12_381_miller_loop(p, q)

  // x2_by_mul = e(p,q) * e(p,q) = e(p,q)^2
  let x2_by_mul = bls12_381_mul_miller_loop_result(x, x)

  // x2_by_add = e(p+p, q) = e(2p, q)
  let p2 = bls12_381_g1_add(p, p)
  let x2_by_add = bls12_381_miller_loop(p2, q)

  bls12_381_final_verify(x2_by_mul, x2_by_add)
}

// ---------- Commitment Verification Tests ----------

test verify_commitments_valid_proof1() {
  // Use the same VK and proof from valid_groth_proof1
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 37,
      vkAlpha: #"abee8b9ac29a8c210210305b37260d1f6feab3a280ac5c4b405e5059c8575cf4b64a3c0137c3af086fb54adc3d0e88a7",
      vkBeta: #"81d0685ade0fb4e315d0903531d326c04bbd119cb85225446b4df7c05d986adb01ab87a50ddcd2bc45721a213210e5ae01f1e3b174a4fb7697aea8a0ff76689b310c53323cd833e2ce78eda70851015a3f19804e962613fce70a0106369fbc71",
      vkGamma: #"82471a11a3fe0376d7d418da6698d0a38cf48625ae8568e2114cd059717cfa139b72f3c56d2112444096580007e4f18c16ff4107abddef629a6bf442c3569d0b6af714a220c2443199cd66d41dd562f06d11182bbb15ac51008f320fab2841fe",
      vkDelta: #"94b47a4e90988d11e4518d156becc18899e92e326cfdfacd7e1d642612da093623a477efca132cc34f5b02cd55baabfd00999e419976f939c6e8bb531b08a46184fd85015729313470242564fd4ab9d83d53d70715b57faf9d2e74c5b2cb0e6f",
      vkIC: [
        #"960c021e695ef894b57ac3b3e965de7050facb0ccfb02842a481c3d186d53976af7ee27f46f315d427c388b0d5df7cdd",
        #"a19900f5b3770f49901824edc74cd7f05fa10ef6fb7e1a56d0e8e82afbaca7ca03d43d1aaed54cf73ad6dacda66fb9cb",
        #"a3fdf2bf06edd8a6c308d9c680e56cc12c76f5ac207000f0e0ea50d2a5f04cfdb386b3b81b1aacd3ffb07770c760ef52",
        #"b121796f0d692bd1cbcd8779fc5bb5637a0ec84f9efcb0fbe24d26205cd5c1e78374982186ecaef204805e2669723497",
        #"8494e95b76ebef2b508bffec157f604e0b8f45afa41d0223511c77b0246468424db3a70471493ca795972f498b3fa02e",
        #"93f663d0c0d492f03bb5e0882179252acb0443a6604dace9eacef876d51c7578ee7486b0369e6c35ec52c9381ea6acff",
        #"98e817ec48aa8b11c72b85bcf3beac384dacdeb9cd43089f9cc8ff3eb5aefd8a8f3b18cc1ee7e8a1cdab365fc5fc7465",
        #"8a71bc7f972ff091a96e5940b610845e9e590add777d1967969edfd630fb5b727755e1f1c98e15b661dd7b5571102a65",
        #"b0a7eeecdb147f0c99f32f00d2a331b9fcf2086916e179c13347db9bb43c962838ac06529893efcebc3db62b3d0122c1",
        #"a1394ad02bc64c88d4cbc31825ea34b7c67b08b74e64528feb8862d8e28417507c0a659f43664e234e6b99252faa382f",
        #"9586bf376cded257545842b236efae3d6379454bf8678009636efbd7e82282024b9fe9c22b67240f8d7000464356191d",
        #"864a7aa3d3942d4d4ef6c3cf6651e3b89a0c80d847b03b8d9aa1d150ed25d5183c97b5a472c33d9d65a07658fe15444c",
        #"ab7ba6def583d4bc86f21fc68920afb86165ff8e6e707c36357b8020ebe819f3eb0378e7e34d6d50516b5d19f62cc77a",
        #"a4dfa03b064f6565b05a51fa54a07d6a5fbfea331a0ccc04909f78d186b8e684e3b371338c4e005d0ad5f9d12aa88f61",
        #"ab6c4532943af63d9f3c96add10c3269002db50689b14bf4eadd13b35383af53513400c63ae9e83acd7cc083232794cf",
        #"b1426817418425801a25c424bf5399313b7919ef019ae9c9eb9d3d8358fe318a803af80983b191f0b28ba288461a805c",
        #"8fa08bc302b733a603135f13a87ea368a92e1d1b2b723af37d1e947395b23e5e4c91ba2190e3383437bed348df7684ad",
        #"a6a0e413681c4980c39d882df0dce73fe1b8600d7239804111b8112aef3807b68da0c3186efe743ef720b4a647acdd6d",
        #"8d5bcd982335f146402ade7d9cf89ee6ebd5c28f5ecef04f324c901316315e470f4abe46732521c0456f96a20198cc64",
        #"85a36cc938eee988a492da835b9c5b22196531fe6b60dba45ba7735c6fdee16aa6b9d0f11f53cf90b60a7639e2a06d06",
        #"8fc63f95cb58d977a1f048ca5e98549ee75ff9eb3248dc233c5cef11a2e9aecad8c73d23668944483e46047497e8fc01",
        #"aed031033af87dc6c6f6a7c5cc84a020e80d00609cdcf507cb28fb44f43900f8eda445361eb80b024d350c049fcc73e2",
        #"934cf97ee2e0ae7432877eb835aa190d16fceb5a1a613917758fcce2176e74f95217d27b470f652605400bb180b61c7b",
        #"ae5cb1661fec22d653eef8555ed157f41a6379829bf66fd72904ec57c2c5bbaf990d49c3bbff5f3b48642cfb40d27139",
        #"9042c63f7c9da430a8a645215bea475e69eb2e6edd0402b183e80a5bd0db895df649fbf4210136f794a6844f5062fa5e",
        #"ade1adb3867902a71f298dfe3e41962860617de87eaf56295c1915895f275b514d3e265b69b28d9a18074be0380bd3d7",
        #"aa532a52fa875d6abfe9f654d1d1b3b5525160c5bc6fcba3e7fb138deab71e49b6a7f6dd9cedff2612c0e7593c397da2",
        #"92ef20b372a8c097414d63f02816df8deaab0bd7d01764e28ff5bb96f32f567b2b1c6cae99453236f5284eb7bb6b3194",
        #"8b625074fc0972640e882e22cc028c8b267106f60b3aabaa5927be85787761b5869dc996188c1a3d91e90b72685dcec9",
        #"b34253e73c7880ad426ef5ae456feb8c25d546cf3d6bf69746e5b81b6ea1de8b126cfe77a6f2777154a182014ce5ed5e",
        #"b498d45c81e6363f7c9e4e2836fbd52eb96d4884fd88dbcc0665944d12493deedaaf4a18ab5e41b4a85c8b53768cf99e",
        #"a8230a7c9ccf370c2199fc2958682ac5fab2c4c059bbe0e4177bca196654d103a776a9ee932659d1ff737de4a6de6e77",
        #"8ab0b3a39ee93d203e8bb4b15a772174bd7d7db0e90f77f96b6aded042194d25245ca9f48586934bf0e87656ceafc2a2",
        #"b580dfb0134b03add7e2dfd2dc9c577a4ec4f180bec098b8c649c70c062a2ca52ee236401ea7a136eb7dd85cc2142174",
        #"b4e004d5c30039974ef309727aa7d8220a7a9cf68776ea78e0b1468048ec292122b65a519fdd08c4957b3d3b92e1443b",
        #"b39ad8c16efe0c9c8d696f7ffc18552cbd715edab02b8daea65b04ea1da3b8d768ce39f651f17dad97a47eb86c76130e",
        #"a67508287a5d797788014de16466a369c1e65a5d7a7566112a907b22281aac3e415b7cb27368678fc508e3bee822d044",
        #"adcc0878ee64a10b26bd1729c645c79ede68b2282ac5e9220ddf13acfa1442c265fe4fc0c3afd35c5254a88097acfd8e",
      ],
      commitmentKeys: [
        CommitmentKey {
          g: #"816a62146ee46d57c1969db77d7ab0056440dee8851d21bcc8036bd21b8c8d79171c24497c622fbcfc2421865d109f2302d29e3751e6d27ba2fbc792d699072135cbee6627d442185e12c8669584572d49890a14f69f1db286db17c3391f06c7",
          gSigmaNeg: #"86ef4a255377b2deeccc465e00d62660bfa6f7324f5928f7d0889479985ee8164217cbbbc7f71cb8bf372022f2432b3c14482c3deb86212c59710d4ebbeebba0d49727e875994b7346b36d7dc61c2026b94e4b25c53208f9a58a3c7b4b1d8ebd",
        },
      ],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"99d5bcfeb866aca22f1e3b222ac626106e10de89f4fd4ecc4eae742f346dd6106b87bd04de90398de7d6b683e80693e7",
      piB: #"84b1a59d6858416e68b489af5eace9bcbd26d41a1aec69fdba3021d8752d5303f922be7e1ded54a432f8428584e9d954124a4f18afd472e9404ec824e2bfd1b7440dd2077bd0240491e527b4d7a9e25304ecfd8a8d10dbcb8c1cfe3400bc25a4",
      piC: #"8d7f86284feda80e734fbc258d9239859bb34f833a66ab5d23ed72a97ce748a04ecd6a4f12f41dd15c8faa723ffde3cc",
      commitments: [
        #"847e670acbc6937cd7f93c90de99d3db2532ae25aa016721b041af51f03d39aeee7446a042b612467420937b188fe230",
      ],
      commitmentPok: #"b4aac57fabe8f02fb596a1b03108f822b3bfd60799b32f459af582dfffbdffecaae176e4482e52328c56f9b57ce27abd",
    }

  groth.verify_commitments(vk, proof)
}

test verify_commitments_valid_proof2() {
  // Use the same VK and proof from valid_groth_proof2
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 37,
      vkAlpha: #"b509ade27b2378801661877950ba25cb96d0efc874e99f912d5ef9e3d5890207d3f97870755da6159bc990f096135eb5",
      vkBeta: #"b47534fe779bf7daf3691ee513d9ca16e45c9a210032a86202040b8e749a907456c755d052debd1cb32a6896ea37e8e81537cb9cec6847e4d0fb194cf7dc25926e5e3a14961b8411d467132b1693f9f03a15b134260d4f8ebce57e42a4da095f",
      vkGamma: #"97562c6824438fe563498d0c28a0e14a6b8d6f0f2cbbb41245159225b9af05d0378a0ba9962df2daf55914787ecedbe30b79b0b6eb4d55707dae5a0fdf60fc6e4454c5e2e1512621c1b7cc25f2f9226ac84f7ccc3ead1a89335e73126104b615",
      vkDelta: #"af518f4d22ab8e79e5c9d0cf0d57d1c20278dc57d5538413a14cc44b75c4ffa59c646a406638c15fcfd9c61fb786571314aa8afbca24112e97c2ef6fc19395c038430ed8c86471317459498ab9c154289d9c6f3638a8f486d9592e21aa552898",
      vkIC: [
        #"8d0ac4bf3742f322ff87330ca9a20adf4fbaa4b051da865d13bbd3cb873b12665de4b62fd25246916beb1a9b5cb53e2d",
        #"a00b49b1cd11a9e0f0c5892d56de13ea95a7a274e90b90246c2d2f15f4971f1a907455b565c907563e5421326ea275f8",
        #"aac63a151b40f81228b4e2e88563a9e551255249efc8dfe6e84a6da3f100d88446382f56a7c586a7a1fbcd2f0faf51d8",
        #"85b16dea6167f6afe3c1097d77d2f81963af0babb9d88169ad86c3d4a88a17ce1ee0dbfd934a4741c81ed6646d4ea0dc",
        #"899091320ebf909a5c19e97876abf7a2f162a060271b966e8ecd52dfa6312f0caa7ea5b9f18ff167b6594081a13cf1c9",
        #"92d15311593fad747f476ecaf9bcabdabd1e6e494b0857c4ffba9e6c58b80772a94a9ebbd22666e8dee76788ea52b2ee",
        #"b074196a6800386c5adb94865210207cebdb5e9b2306e423e2c94af4f7f2256979a3e2aea7b8fb09d169e2b0b7085911",
        #"8571b904a2f0a049b6b8e92a36d8e8c34f508e887ad136facbff2fb86759a5858be3e7d2bd6853e3a605412a4bffb641",
        #"86b2659feddc91964aac9bf3aef2848140bd6a1e4851d0d98af4dc477357a222892fe8a72168368acb5a758c8045baf0",
        #"8684b8f381a00ed88ad767048d3a44975fed6e2df3000ce52f081c9ff06de0d47c4140727f0a0aa7c9a2ea316387aff7",
        #"b60be073020c42c2eb2a0b6e799e20e3c04b70e0ac78424d717c79beebcdd4d123a2199cd44679186f990ebcd3677aef",
        #"a6ef01888651898aa4c697ae7c615d80e6dcaa6e9d7e8931e76c98c44aaf4a3297bed6e814caa908ef5f8351d8b1cacd",
        #"ad40e84cad2a9b1f25e677ebba62cdae389d2fbbabf449853a985903917e08f8402a5555c3622f2ae5c0aacfeb87e041",
        #"b6a8f111f20fc19e0b263b2717e87ae7987608bd7da9ed499a7187feeecb442a986d172d95b5898a13902ec174d174bb",
        #"b200cd7e692f8accea6420833ef4853a76590f0920eb540026eb90b059010d96275ea4eef1edd8dbb70722ca8f7f2fa1",
        #"85d36561043785eb19cf8a89af9490bbfa0f638ffd2b915c3ac79b7aa2930660654c441d1fd6b0f2faf8b286bbe1c199",
        #"b805fa647722cfcb0f12be6d7717062a688962c6cb44784b7f1b795ee0fd9f18bc51002765a6e43d80e3065e0b0d92eb",
        #"b5f05efeff86f4a62db3c2a81d0e6b83f035747580dc10ca8938f71a9194c1cc4827d18d242af1d4d19be3ff6e92b31d",
        #"a34f7bf6bc53887904d4ae11db3e0fc291c28fcbd6ab50f3882f76ad9288716fe52fe665fa1de133fb7c527828372308",
        #"b4e3f4b6492a77ca8b1802a7f9df7cba5f3cc890b07e3b9d07defc6d1d66c9d9114415e80ba6d3ef6c13b4986e847f44",
        #"b4e6e23c5b964b15a040015738514f846c134f535a6e00a375db9d1b43622c7f6c4e24d87b2d8ad8c004bf5d087c44e3",
        #"a22243e393313d4ba55301937c0b492f9ae4419d6bf93c4ee390f4524e43facdb5d2e5b12e922c0fd22cd483bf02b90d",
        #"a1fc7603623063b3345e4a3e7699dd1e4b1985a810d7cf7f5f338264dc893125bf8b325b3e344fb3bc9e2a69e6870da2",
        #"8f83a820c5deff881eb6fa4f9b74bf5243e46bd2e5ca55af3655bcaa3d2fbeaed1bea087abeef917e7b57456fd03c6e8",
        #"aea448d6ff6a34b0ba0aa7cea9db2d1a4718d901e100222c220e5f527cc0a7f4e2c16ecf19e3578f40ffae9a6c5bbc7e",
        #"99e3d1c0815ea15d13e5774f6734347b437c1a8dfb00fca2654ea7ec7d2c0a5325a34a578cfc2b20608917feff87fd73",
        #"a4256a41a76a3422de321b7e398281ea97fcf77040b225084e44c62b1098d881d011a68b781a1c1def15c32939dddb44",
        #"820f181fbb75731f9a2970d1a3f44c62e57085bfd9d4498925aa9e54cabe07398fb17a8137c325c0838c05c96ed6a639",
        #"952631b20eebb6f99da053b952672477ad55ad0079fd86a1399ab78034f7d24580d2fee59f504835840912dcc2e6d8dd",
        #"820f3e4537a10e354bd4adc929b52128326e626bcf8ae630c5fbffe9a305ec6d1fb681b573995944f2778127b9119e53",
        #"ac9faed713abd9981670a032d76efa13130bcd8aee70e86c3aaef6d89f51437a3ddbc6ac7446638f0b061506d9a432ee",
        #"8de2a42760310cc61ab660d709f3e2cb84b970a64599b70ba47c8aa73a144f9022cb4beb9022b4d7f55ee5a7060f72bd",
        #"a3cdfc683ba5d6918b1f256a9aba28cadf7acf71f52077af377d2cba1ff82267a997e33136e4e50d6a9fa8874576a61a",
        #"8d31ee5889eeb4ecf9fa0a16eb43ba4940a1ca541eedcb07fef4d5a45a5bf78fe9c67607ead42a17a58852e55e5c90ec",
        #"944aa0a0a27c27adc2a9540c42e928263ab6149e381656de66e200c936fe0a2832b3f6a0a6b3191184c48cfb898fcb3b",
        #"ae8c39708377632e7711acb4b0edf0ad7fa71c0b41a56623672112df5c48ebd7e8893f42cc65c2b92de576d06e18dfe1",
        #"ac745c9128e775743036c8c15ebf31b4ce7847838237123bda592e988c11e5237c50fffb73ad8fbad78892a653abb46b",
        #"81e31a4c9cdf455ab3ca11d89652a62e3f81c4ca158bd2bf2c5dc30d89a4ca9113dbb3c030caa662a31a9e3f4a0faef0",
      ],
      commitmentKeys: [
        CommitmentKey {
          g: #"8b021b14ca2a446dbfcee3854b7d11582d5be9a4cf08c700aed0c3b697912cba51b6394184f0fe14edd132dbad0bccc816f80fafdb9389f858c0bf233f9ad11e1f1c4054e5fdce51d8087a8f4e76a8c0c12c1c18132f7eb919dc295ca4372cfb",
          gSigmaNeg: #"a33d5a37fe9894343ccb2142ac474aa564c20d3ac7638b58f95c44ffa44f7f52053d9dc52c3bd939a568457f28ea8d82064644c1207c2943969fac22bfa12eef6d157dff7dad385c2a12615b98961a671197a6d07747048e78540d84c2199bb2",
        },
      ],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"b878286b554c994c672eac483733f1e5794a5de88dddd504502c796eb696ac4a93f9a2c3e77ccbf9d48c4092aad3d89e",
      piB: #"824f89db10bf130cf41d746d9f891f01ff22992a6dd2e4a174b3add9b9b245249b15507f5fab688c13cbda1dd323fcd80b304b2e897bf41f643b773505fb4354c4251593f20bc4bbb8e8c4acd44f9f611295f77bd8a180d0d5b8287818acfdd7",
      piC: #"b3e5604d92619a4de04bbb03a2648df4d2c497f85962f9b8e2ef19ef4fec4ad2a611d57397519559a0a93a6c94e7f985",
      commitments: [
        #"ae619bf35f03603a589dc49e7c71b1c25db46196e8dbd854877f89ff02f59078ba58c888762ec68a5bc27b89b07ca58d",
      ],
      commitmentPok: #"b612b81a3810a494c939725c8dd6180c4abd702b16d183e5e8365a7d28a6a249ec1ab95625887567482c85307b939602",
    }

  groth.verify_commitments(vk, proof)
}

test verify_commitments_empty_commitments() {
  // Test that empty commitments returns True
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 1,
      vkAlpha: #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
      vkBeta: #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
      vkGamma: #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
      vkDelta: #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
      vkIC: [],
      commitmentKeys: [],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
      piB: #"93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
      piC: #"97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
      commitments: [],
      commitmentPok: #"",
    }

  groth.verify_commitments(vk, proof)
}

test verify_commitments_invalid_pok() fail {
  // Test that wrong PoK fails verification
  let vk: SnarkVerificationKey =
    SnarkVerificationKey {
      nPublic: 37,
      vkAlpha: #"abee8b9ac29a8c210210305b37260d1f6feab3a280ac5c4b405e5059c8575cf4b64a3c0137c3af086fb54adc3d0e88a7",
      vkBeta: #"81d0685ade0fb4e315d0903531d326c04bbd119cb85225446b4df7c05d986adb01ab87a50ddcd2bc45721a213210e5ae01f1e3b174a4fb7697aea8a0ff76689b310c53323cd833e2ce78eda70851015a3f19804e962613fce70a0106369fbc71",
      vkGamma: #"82471a11a3fe0376d7d418da6698d0a38cf48625ae8568e2114cd059717cfa139b72f3c56d2112444096580007e4f18c16ff4107abddef629a6bf442c3569d0b6af714a220c2443199cd66d41dd562f06d11182bbb15ac51008f320fab2841fe",
      vkDelta: #"94b47a4e90988d11e4518d156becc18899e92e326cfdfacd7e1d642612da093623a477efca132cc34f5b02cd55baabfd00999e419976f939c6e8bb531b08a46184fd85015729313470242564fd4ab9d83d53d70715b57faf9d2e74c5b2cb0e6f",
      vkIC: [
        #"960c021e695ef894b57ac3b3e965de7050facb0ccfb02842a481c3d186d53976af7ee27f46f315d427c388b0d5df7cdd",
        #"a19900f5b3770f49901824edc74cd7f05fa10ef6fb7e1a56d0e8e82afbaca7ca03d43d1aaed54cf73ad6dacda66fb9cb",
      ],
      commitmentKeys: [
        CommitmentKey {
          g: #"816a62146ee46d57c1969db77d7ab0056440dee8851d21bcc8036bd21b8c8d79171c24497c622fbcfc2421865d109f2302d29e3751e6d27ba2fbc792d699072135cbee6627d442185e12c8669584572d49890a14f69f1db286db17c3391f06c7",
          gSigmaNeg: #"86ef4a255377b2deeccc465e00d62660bfa6f7324f5928f7d0889479985ee8164217cbbbc7f71cb8bf372022f2432b3c14482c3deb86212c59710d4ebbeebba0d49727e875994b7346b36d7dc61c2026b94e4b25c53208f9a58a3c7b4b1d8ebd",
        },
      ],
    }

  let proof: GrothProof =
    GrothProof {
      piA: #"99d5bcfeb866aca22f1e3b222ac626106e10de89f4fd4ecc4eae742f346dd6106b87bd04de90398de7d6b683e80693e7",
      piB: #"84b1a59d6858416e68b489af5eace9bcbd26d41a1aec69fdba3021d8752d5303f922be7e1ded54a432f8428584e9d954124a4f18afd472e9404ec824e2bfd1b7440dd2077bd0240491e527b4d7a9e25304ecfd8a8d10dbcb8c1cfe3400bc25a4",
      piC: #"8d7f86284feda80e734fbc258d9239859bb34f833a66ab5d23ed72a97ce748a04ecd6a4f12f41dd15c8faa723ffde3cc",
      commitments: [
        #"847e670acbc6937cd7f93c90de99d3db2532ae25aa016721b041af51f03d39aeee7446a042b612467420937b188fe230",
      ],
      // Wrong PoK - using piA instead of actual PoK
      commitmentPok: #"99d5bcfeb866aca22f1e3b222ac626106e10de89f4fd4ecc4eae742f346dd6106b87bd04de90398de7d6b683e80693e7",
    }

  groth.verify_commitments(vk, proof)
}
